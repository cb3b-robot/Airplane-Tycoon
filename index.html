<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Airplane Tycoon</title>
<style>
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: Arial, sans-serif;
  }
  #map { height: 100%; width: 100%; position: fixed; top: 0; left: 0; z-index: 1; }
  #airport-list {
    position: fixed; top: 10px; left: 10px; z-index: 1000;
    background: rgba(255,255,255,0.9); padding: 10px;
    max-height: 90vh; overflow-y: auto;
    width: 220px;
    border-radius: 5px;
  }
  #airport-list h2 {
    margin-top: 0;
  }
  #airport-list ul {
    list-style: none;
    padding-left: 0;
  }
  #airport-list li {
    cursor: pointer;
    padding: 6px;
    border-bottom: 1px solid #ddd;
  }
  #airport-list li:hover {
    background-color: #f0f0f0;
  }
  #topbar {
    position: fixed; top: 10px; right: 10px; z-index: 1000;
    background: rgba(255,255,255,0.9); padding: 10px;
    border-radius: 5px;
    display: flex; gap: 15px;
  }
  #upgrades {
    position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%);
    z-index: 1000;
    background: rgba(255,255,255,0.95);
    padding: 10px;
    border-radius: 5px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    max-width: 95vw;
  }
  #tutorial-overlay {
    position: fixed;
    background: rgba(0,0,0,0.8);
    color: white;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
  }
  #tutorial-overlay > div {
    background: #222;
    padding: 25px;
    border-radius: 10px;
    max-width: 350px;
    text-align: center;
  }
  button {
    cursor: pointer;
    padding: 8px 14px;
    font-size: 14px;
  }
  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  .plane-icon {
    font-size: 24px;
    pointer-events: none;
  }
</style>
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
/>
</head>
<body>

<div id="airport-list">
  <h2>Choose Starting Airport</h2>
  <ul id="airport-items"></ul>
</div>

<div id="map"></div>

<div id="topbar" style="display:none;">
  <div>üí∞ Money: $<span id="money">0</span></div>
  <div>‚úàÔ∏è Planes: <span id="planes">0</span></div>
  <div>üöÄ Plane Tier: <span id="plane-tier">Basic</span></div>
  <div>‚≠ê VIP Customers: <span id="vip-status">No</span></div>
</div>

<div id="upgrades" style="display:none;">
  <button id="buy-plane-btn">Buy Plane ($10,000)</button>
  <button id="upgrade-plane-btn">Upgrade Plane ($50,000)</button>
  <button id="unlock-airport-btn">Unlock Airport ($20,000)</button>
  <button id="buy-vip-btn">Unlock VIP Customers ($100,000)</button>
  <button id="reset-progress-btn" style="background:#dc3545; color:white;">Reset Progress</button>
</div>

<div id="tutorial-overlay">
  <div>
    <h1>Welcome to Airplane Tycoon!</h1>
    <p>
      Select your starting airport from the list on the left.<br/>
      You begin with 1 basic plane and $50,000.<br/>
      Fly planes between airports to earn money.<br/>
      Use money to buy more planes, upgrade planes, unlock VIP customers, and unlock more airports.<br/>
      Expand your airline and become a tycoon!
    </p>
    <button id="start-btn" disabled>Select an Airport First</button>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {

  // Airports with initial unlock status and cost to unlock
  const airports = [
    { code: "JFK", name: "John F. Kennedy International Airport", coords: [40.6413, -73.7781], unlocked: false, cost: 20000 },
    { code: "LAX", name: "Los Angeles International Airport", coords: [33.9416, -118.4085], unlocked: false, cost: 20000 },
    { code: "ORD", name: "O'Hare International Airport", coords: [41.9742, -87.9073], unlocked: false, cost: 20000 },
    { code: "ATL", name: "Hartsfield‚ÄìJackson Atlanta International Airport", coords: [33.6407, -84.4277], unlocked: false, cost: 20000 },
    { code: "LHR", name: "London Heathrow Airport", coords: [51.4700, -0.4543], unlocked: false, cost: 25000 },
    { code: "NRT", name: "Narita International Airport", coords: [35.7719, 140.3929], unlocked: false, cost: 25000 },
    { code: "DXB", name: "Dubai International Airport", coords: [25.2532, 55.3657], unlocked: false, cost: 30000 },
    { code: "SYD", name: "Sydney Kingsford Smith Airport", coords: [-33.9399, 151.1753], unlocked: false, cost: 30000 }
  ];

  // Game state variables
  let money = 50000;
  let planes = 1;
  let currentAirport = null;

  const planeTiers = [
    { name: "Basic", earningsMultiplier: 1, upgradeCost: 50000 },
    { name: "Advanced", earningsMultiplier: 2, upgradeCost: 150000 },
    { name: "Luxury", earningsMultiplier: 5, upgradeCost: 500000 }
  ];
  let currentPlaneTierIndex = 0;

  let vipUnlocked = false;
  const vipMultiplier = 2;

  // Map setup
  const map = L.map('map').setView([20, 0], 2);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Markers stored by airport code
  const airportMarkers = new Map();

  // Add markers, popups, and label for airports
  airports.forEach(airport => {
    const marker = L.marker(airport.coords).addTo(map);
    marker.bindPopup(`<b>${airport.code}</b><br>${airport.name}`);
    airportMarkers.set(airport.code, marker);
  });

  // Update airport list UI
  const airportListUl = document.getElementById('airport-items');
  const startBtn = document.getElementById('start-btn');
  const tutorialOverlay = document.getElementById('tutorial-overlay');
  const topbar = document.getElementById('topbar');
  const upgradesDiv = document.getElementById('upgrades');

  function updateAirportList() {
    airportListUl.innerHTML = '';
    airports.forEach(airport => {
      const li = document.createElement('li');
      li.textContent = `${airport.code} - ${airport.name}`;
      if (airport.unlocked) {
        li.style.fontWeight = 'bold';
      }
      li.onclick = () => {
        if (!currentAirport) {
          currentAirport = airport;
          startBtn.disabled = false;
          highlightSelectedAirport();
        } else if (airport.unlocked) {
          flyToAirport(airport);
        } else {
          alert(`This airport is locked. Unlock it for $${airport.cost.toLocaleString()}.`);
        }
      };
      airportListUl.appendChild(li);
    });
  }

  function highlightSelectedAirport() {
    const lis = airportListUl.querySelectorAll('li');
    lis.forEach(li => {
      li.style.backgroundColor = '';
    });
    const idx = airports.findIndex(a => a === currentAirport);
    if (idx >= 0) {
      airportListUl.children[idx].style.backgroundColor = '#d0f0d0';
    }
  }

  // Start button logic
  startBtn.onclick = () => {
    if (!currentAirport) {
      alert('Please select a starting airport first!');
      return;
    }
    // Unlock selected airport
    airports.forEach(a => a.unlocked = false);
    currentAirport.unlocked = true;

    // Hide tutorial and airport list
    tutorialOverlay.style.display = 'none';
    document.getElementById('airport-list').style.display = 'none';

    // Show game UI
    topbar.style.display = 'flex';
    upgradesDiv.style.display = 'flex';

    // Initialize game state UI
    updateInfo();
    updateButtons();

    // Save progress
    saveProgress();

    // Start flight animation
    startFlight(currentAirport, currentAirport); // Start with no flight
  };

  // Update money, planes, tier, VIP display
  const moneySpan = document.getElementById('money');
  const planesSpan = document.getElementById('planes');
  const planeTierSpan = document.getElementById('plane-tier');
  const vipStatusSpan = document.getElementById('vip-status');

  function updateInfo() {
    moneySpan.textContent = money.toLocaleString();
    planesSpan.textContent = planes;
    planeTierSpan.textContent = planeTiers[currentPlaneTierIndex].name;
    vipStatusSpan.textContent = vipUnlocked ? 'Yes' : 'No';
  }

  // Plane flying logic
  let planeIcon = null;
  let flightProgress = 0;
  let flightFrom = null;
  let flightTo = null;
  const flightSpeed = 0.002;

  function startFlight(fromAirport, toAirport) {
    flightFrom = fromAirport;
    flightTo = toAirport;
    flightProgress = 0;

    if (!planeIcon) {
      planeIcon = L.marker(flightFrom.coords, {
        icon: L.divIcon({
          className: 'plane-icon',
          html: '‚úàÔ∏è',
          iconSize: [24, 24],
          iconAnchor: [12, 12]
        }),
        interactive: false
      }).addTo(map);
    } else {
      planeIcon.setLatLng(flightFrom.coords).addTo(map);
    }
  }

  function animateFlight() {
    if (!planeIcon || !flightFrom || !flightTo) return;
    if (flightFrom === flightTo) return; // no flight in progress

    flightProgress += flightSpeed;
    if (flightProgress > 1) {
      flightProgress = 0;
      // Earn money
      let earnings = 2000 * planes * planeTiers[currentPlaneTierIndex].earningsMultiplier;
      if (vipUnlocked) earnings *= vipMultiplier;
      money += earnings;
      updateInfo();
      saveProgress();

      // Swap flight
      const temp = flightFrom;
      flightFrom = flightTo;
      flightTo = temp;
    }
    const lat = flightFrom.coords[0] + (flightTo.coords[0] - flightFrom.coords[0]) * flightProgress;
    const lng = flightFrom.coords[1] + (flightTo.coords[1] - flightFrom.coords[1]) * flightProgress;
    planeIcon.setLatLng([lat, lng]);
  }

  // Upgrades buttons
  const buyPlaneBtn = document.getElementById('buy-plane-btn');
  const upgradePlaneBtn = document.getElementById('upgrade-plane-btn');
  const unlockAirportBtn = document.getElementById('unlock-airport-btn');
  const buyVipBtn = document.getElementById('buy-vip-btn');
  const resetBtn = document.getElementById('reset-progress-btn');

  buyPlaneBtn.onclick = () => {
    if (money >= 10000) {
      money -= 10000;
      planes += 1;
      updateInfo();
      saveProgress();
      updateButtons();
    } else {
      alert('Not enough money to buy a plane!');
    }
  };

  upgradePlaneBtn.onclick = () => {
    if (currentPlaneTierIndex < planeTiers.length - 1) {
      const nextTier = planeTiers[currentPlaneTierIndex + 1];
      if (money >= nextTier.upgradeCost) {
        money -= nextTier.upgradeCost;
        currentPlaneTierIndex++;
        updateInfo();
        saveProgress();
        updateButtons();
      } else {
        alert('Not enough money to upgrade plane!');
      }
    } else {
      alert('You have the best plane tier!');
    }
  };

  unlockAirportBtn.onclick = () => {
    const lockedAirport = airports.find(a => !a.unlocked);
    if (!lockedAirport) {
      alert('All airports unlocked!');
      return;
    }
    if (money >= lockedAirport.cost) {
      money -= lockedAirport.cost;
      lockedAirport.unlocked = true;
      const marker = airportMarkers.get(lockedAirport.code);
      if (marker) marker.bindPopup(`<b>${lockedAirport.code}</b><br>${lockedAirport.name}`);
      updateAirportList();
      updateInfo();
      saveProgress();
      updateButtons();
    } else {
      alert(`Not enough money to unlock ${lockedAirport.code}!`);
    }
  };

  buyVipBtn.onclick = () => {
    if (vipUnlocked) {
      alert('VIP Customers already unlocked!');
      return;
    }
    if (money >= 100000) {
      money -= 100000;
      vipUnlocked = true;
      updateInfo();
      saveProgress();
      updateButtons();
    } else {
      alert('Not enough money to unlock VIP Customers!');
    }
  };

  resetBtn.onclick = () => {
    if (confirm('Are you sure you want to reset progress?')) {
      localStorage.removeItem('airplaneTycoonSave');
      location.reload();
    }
  };

  function updateButtons() {
    buyPlaneBtn.disabled = money < 10000;
    unlockAirportBtn.disabled = !airports.some(a => !a.unlocked && money >= a.cost);
    upgradePlaneBtn.disabled = (currentPlaneTierIndex >= planeTiers.length - 1) || money < planeTiers[currentPlaneTierIndex + 1].upgradeCost;
    buyVipBtn.disabled = vipUnlocked || money < 100000;
  }

  // Fly to selected airport
  function flyToAirport(airport) {
    if (airport === currentAirport) {
      alert('You are already at this airport!');
      return;
    }
    startFlight(currentAirport, airport);
    currentAirport = airport;
    highlightSelectedAirport();
  }

  // Save/load game progress
  function saveProgress() {
    const saveData = {
      money,
      planes,
      currentAirportCode: currentAirport ? currentAirport.code : null,
      airportsUnlockedCodes: airports.filter(a => a.unlocked).map(a => a.code),
      currentPlaneTierIndex,
      vipUnlocked
    };
    localStorage.setItem('airplaneTycoonSave', JSON.stringify(saveData));
  }

  function loadProgress() {
    const saveStr = localStorage.getItem('airplaneTycoonSave');
    if (!saveStr) return false;
    try {
      const saveData = JSON.parse(saveStr);
      money = saveData.money ?? money;
      planes = saveData.planes ?? planes;
      airports.forEach(a => {
        a.unlocked = saveData.airportsUnlockedCodes.includes(a.code);
      });
      currentPlaneTierIndex = saveData.currentPlaneTierIndex ?? 0;
      vipUnlocked = saveData.vipUnlocked ?? false;
      currentAirport = airports.find(a => a.code === saveData.currentAirportCode);
      return true;
    } catch {
      return false;
    }
  }

  // Initialization
  function initGame() {
    updateAirportList();
    updateButtons();

    if (loadProgress()) {
      if (currentAirport) {
        // Hide tutorial UI
        tutorialOverlay.style.display = 'none';
        document.getElementById('airport-list').style.display = 'none';
        topbar.style.display = 'flex';
        upgradesDiv.style.display = 'flex';
        updateInfo();
        updateButtons();
        highlightSelectedAirport();
        startFlight(currentAirport, currentAirport);
      } else {
        // Show tutorial if no current airport
        startBtn.disabled = true;
      }
    } else {
      // New game: wait for airport selection
      startBtn.disabled = true;
    }
  }

  // Animate loop
  function gameLoop() {
    animateFlight();
    requestAnimationFrame(gameLoop);
  }
  requestAnimationFrame(gameLoop);

  initGame();

});
</script>

</body>
</html>
