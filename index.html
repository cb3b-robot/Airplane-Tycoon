<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Airplane Tycoon</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
body { margin:0; display:flex; font-family:sans-serif; height:100vh; }
#panel { width:300px; background:#f0f0f0; padding:10px; overflow-y:auto; }
#map { flex:1; height:100vh; min-width:0; width:100%; }
button { margin:5px 0; width:100%; padding:5px; }
h2,h3 { margin:5px 0; }
.airport-item, .plane-item { margin-bottom:3px; cursor:pointer; }
#tutorial { background: rgba(0,0,0,0.8); color:#fff; position:absolute; top:50%; left:50%;
  transform:translate(-50%,-50%); padding:20px; display:none; max-width:300px; }
</style>
</head>
<body>

<div id="panel">
  <h2>Airplane Tycoon</h2>
  <h3>Money: $<span id="money">0</span></h3>
  
  <h3>Airports</h3>
  <div id="airports-list"></div>
  <button id="unlock-airport-btn">Unlock Airport ($20,000)</button>
  
  <h3>Planes</h3>
  <div id="planes-list"></div>
  <button id="buy-plane-btn">Buy Basic Plane ($1,000)</button>
  
  <button id="tutorial-btn">Tutorial</button>
</div>

<div id="map"></div>

<div id="tutorial">
  <h3>Tutorial</h3>
  <p>1. Select your starting airport.<br>
  2. Buy a plane and assign routes.<br>
  3. Collect money manually or earn passive income.<br>
  4. Unlock more airports to expand your airline!</p>
  <button id="gotit-btn">Got it</button>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let storedMoney = localStorage.getItem('money');
let money = storedMoney !== null ? parseInt(storedMoney) : 25000;

let unlockedAirports = JSON.parse(localStorage.getItem('unlockedAirports')) || ['JFK','LAX','LHR'];
let planes = JSON.parse(localStorage.getItem('planes')) || [];

const airports = {
  'JFK': {name:'John F. Kennedy Intl', lat:40.6413, lng:-73.7781},
  'LAX': {name:'Los Angeles Intl', lat:33.9416, lng:-118.4085},
  'LHR': {name:'London Heathrow', lat:51.4700, lng:-0.4543},
  'CDG': {name:'Paris Charles de Gaulle', lat:49.0097, lng:2.5479},
  'HND': {name:'Tokyo Haneda', lat:35.5494, lng:139.7798}
};

const airportCost = 20000;
const planeCost = 1000;
const incomePerPlane = 100;

// Initialize Map
const map = L.map('map').setView([20,0],2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'Â© OpenStreetMap contributors'}).addTo(map);

const airportMarkers = {};
for(const code in airports){
  const marker = L.marker([airports[code].lat, airports[code].lng])
    .addTo(map)
    .bindPopup(`${airports[code].name} (${code})`);
  airportMarkers[code] = marker;
  if(!unlockedAirports.includes(code)) marker.setOpacity(0.3);
}

// UI Elements
const moneyEl = document.getElementById('money');
const airportsListEl = document.getElementById('airports-list');
const planesListEl = document.getElementById('planes-list');
const tutorialDiv = document.getElementById('tutorial');

let planeRoutes = [];

function updateUI(){
  moneyEl.textContent = money;

  // Airports list
  airportsListEl.innerHTML = '';
  unlockedAirports.forEach(code=>{
    const div = document.createElement('div');
    div.textContent = `${airports[code].name} (${code})`;
    div.classList.add('airport-item');
    div.onclick = ()=>alert(`Selected airport: ${code}`);
    airportsListEl.appendChild(div);
  });

  // Planes list
  planesListEl.innerHTML = '';
  if(planes.length===0){
    const div = document.createElement('div');
    div.textContent = 'No planes yet';
    planesListEl.appendChild(div);
  } else {
    planes.forEach((plane,i)=>{
      const div = document.createElement('div');
      div.textContent = `Plane ${i+1} assigned to ${plane.route || 'no route'}`;
      div.classList.add('plane-item');
      planesListEl.appendChild(div);
    });
  }

  updateRoutes();
}

function saveGame(){
  localStorage.setItem('money',money);
  localStorage.setItem('unlockedAirports',JSON.stringify(unlockedAirports));
  localStorage.setItem('planes',JSON.stringify(planes));
}

// Buy Plane
document.getElementById('buy-plane-btn').onclick = ()=>{
  if(money>=planeCost){
    money-=planeCost;
    planes.push({route:null});
    saveGame();
    updateUI();
  } else alert("Not enough money!");
};

// Unlock Airport
document.getElementById('unlock-airport-btn').onclick = ()=>{
  for(const code in airports){
    if(!unlockedAirports.includes(code)){
      if(money>=airportCost){
        money-=airportCost;
        unlockedAirports.push(code);
        airportMarkers[code].setOpacity(1);
        saveGame();
        updateUI();
      } else alert("Not enough money!");
      return;
    }
  }
  alert("No more airports to unlock!");
};

// Tutorial
document.getElementById('tutorial-btn').onclick = ()=>{ tutorialDiv.style.display='block'; };
document.getElementById('gotit-btn').onclick = ()=>{ tutorialDiv.style.display='none'; };

// Assign Routes
planesListEl.addEventListener('click',e=>{
  if(e.target.classList.contains('plane-item')){
    const planeIndex = Array.from(planesListEl.children).indexOf(e.target);
    const airportCode = prompt("Enter airport code for route:");
    if(airportCode && unlockedAirports.includes(airportCode)){
      planes[planeIndex].route = airportCode;
      saveGame();
      updateUI();
    } else alert("Invalid or locked airport.");
  }
});

// Passive Income
setInterval(()=>{
  money += planes.length * incomePerPlane;
  saveGame();
  updateUI();
},5000);

// Draw Plane Routes
function updateRoutes(){
  planeRoutes.forEach(line=>map.removeLayer(line));
  planeRoutes=[];
  planes.forEach(plane=>{
    if(plane.route){
      const startCode = unlockedAirports[0]; // starting airport
      const endCode = plane.route;
      const line = L.polyline([
        [airports[startCode].lat, airports[startCode].lng],
        [airports[endCode].lat, airports[endCode].lng]
      ],{color:'blue'}).addTo(map);
      planeRoutes.push(line);
    }
  });
}

// Ensure map renders correctly
window.addEventListener('load',()=>{ map.invalidateSize(); });

updateUI();
</script>
</body>
</html>
