<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Airplane Tycoon</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
body, html { margin:0; padding:0; font-family: sans-serif; height: 100%; }
#map { width: 100%; height: 60%; }
#ui { padding: 10px; background: #f0f0f0; height: 40%; overflow-y: auto; }
.section { margin-bottom: 10px; }
button { margin: 2px; }
.notification { 
    position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
    background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; border-radius: 5px;
    display: none; z-index: 1000;
}
#tutorial {
    position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
    background:white; padding:20px; border-radius:10px; box-shadow:0 0 10px black;
    z-index:2000;
}
.plane-emoji { font-size: 24px; text-align: center; }
</style>
</head>
<body>

<div id="map"></div>
<div id="ui">
    <div class="section">Money: $<span id="money">0</span></div>
    <div class="section" id="airportsList"></div>
    <div class="section" id="planesList"></div>
    <div class="section">
        <button onclick="restartGame()">Restart Game</button>
        <button onclick="unlockAirport()">Unlock Airport</button>
        <button onclick="buyPlane()">Buy Plane</button>
    </div>
</div>
<div id="notification" class="notification"></div>
<div id="tutorial">
    <h3>Welcome to Airplane Tycoon!</h3>
    <p>Start with 3 airports and a Tiny Plane. Buy planes, fly routes, earn money, and upgrade your planes. Keep your planes maintained for better passenger satisfaction!</p>
    <button onclick="closeTutorial()">Got it!</button>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// ===== GAME DATA =====
const airportsData = [
{ code: 'JFK', name: 'John F. Kennedy Intl', lat: 40.6413, lon: -73.7781 },
{ code: 'LHR', name: 'London Heathrow', lat: 51.4700, lon: -0.4543 },
{ code: 'CDG', name: 'Paris Charles de Gaulle', lat: 49.0097, lon: 2.5479 },
// ... add 47 more airports here ...
];

let gameData = {
    money: 100000,
    unlockedAirports: ['JFK','LHR','CDG'],
    planes: [{ id:1, type:'Tiny Plane', location:'JFK', destination:null, status:'idle', rating:100, maintenance:true }],
    planeIdCounter: 2
};

const planeTypes = [
    { name:'Tiny Plane', cost:50000, speed:0.5, capacity:50, earningsMultiplier:1 },
    { name:'Regional Jet', cost:200000, speed:1, capacity:100, earningsMultiplier:2 },
    { name:'Boeing 737', cost:500000, speed:1.5, capacity:200, earningsMultiplier:3 },
    { name:'Boeing 747', cost:1000000, speed:2, capacity:400, earningsMultiplier:5 }
];

// ===== MAP =====
const map = L.map('map').setView([20,0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:18 }).addTo(map);
let airportMarkers = {};
function updateAirports() {
    for(let code in airportMarkers) map.removeLayer(airportMarkers[code]);
    airportMarkers = {};
    gameData.unlockedAirports.forEach(code=>{
        const airport = airportsData.find(a=>a.code===code);
        const marker = L.marker([airport.lat, airport.lon]).addTo(map)
            .bindPopup(`${airport.name} (${airport.code})`);
        airportMarkers[code] = marker;
    });
}
updateAirports();

// ===== UI =====
function updateUI(){
    document.getElementById('money').innerText = Math.floor(gameData.money);
    document.getElementById('airportsList').innerHTML = '<b>Airports:</b> ' + gameData.unlockedAirports.join(', ');
    const planesDiv = document.getElementById('planesList');
    planesDiv.innerHTML = '<b>Planes:</b><br>';
    gameData.planes.forEach(plane=>{
        const idx = planeTypes.findIndex(pt=>pt.name===plane.type);
        const nextUpgrade = planeTypes[idx+1];
        const upgradeText = nextUpgrade ? `Upgrade to ${nextUpgrade.name} ($${nextUpgrade.cost})` : 'Max plane';
        const maintainCost = planeTypes.find(pt=>pt.name===plane.type).cost*0.1;
        planesDiv.innerHTML += `${plane.type} (Loc: ${plane.location}, Rating: ${plane.rating}, Maint: ${plane.maintenance?"Yes":"No"}) 
            <button onclick="assignRoute(${plane.id})" ${plane.maintenance?"":"disabled"}>Fly</button> 
            <button onclick="autoFly(${plane.id})" ${plane.maintenance?"":"disabled"}>Auto</button>
            <button onclick="upgradePlane(${plane.id})">${upgradeText}</button>
            <button onclick="maintainPlane(${plane.id})">Maintain ($${Math.floor(maintainCost)})</button><br>`;
    });
}
updateUI();

// ===== Notifications =====
function notify(msg,d=2000){ const n=document.getElementById('notification'); n.innerText=msg; n.style.display='block'; setTimeout(()=>n.style.display='none',d); }

// ===== Game Functions =====
function saveGame(){ localStorage.setItem('airplaneTycoonSave', JSON.stringify(gameData)); }
function loadGame(){ const saved=localStorage.getItem('airplaneTycoonSave'); if(saved) gameData=JSON.parse(saved); }
function restartGame(){ if(confirm('Restart?')) { localStorage.removeItem('airplaneTycoonSave'); location.reload(); } }
function closeTutorial(){ document.getElementById('tutorial').style.display='none'; }

// ===== Plane Functions =====
function upgradePlane(id){
    const plane = gameData.planes.find(p=>p.id===id);
    const idx = planeTypes.findIndex(pt=>pt.name===plane.type);
    if(idx<planeTypes.length-1){
        const nextPlane = planeTypes[idx+1];
        if(gameData.money>=nextPlane.cost){ gameData.money-=nextPlane.cost; plane.type=nextPlane.name; plane.maintenance=true; notify(`Upgraded to ${nextPlane.name}`); } 
        else notify('Not enough money');
    } else notify('Max plane');
    updateUI();
}
function maintainPlane(id){
    const plane = gameData.planes.find(p=>p.id===id);
    const cost = planeTypes.find(pt=>pt.name===plane.type).cost*0.1;
    if(gameData.money>=cost){ gameData.money-=cost; plane.maintenance=true; plane.rating=100; notify(`${plane.type} maintained!`); } 
    else notify('Not enough money');
    updateUI();
}
function buyPlane(){
    const pt = planeTypes[0]; // Tiny Plane
    if(gameData.money >= pt.cost){
        gameData.money -= pt.cost;
        const newPlane = { id:gameData.planeIdCounter++, type:pt.name, location:gameData.unlockedAirports[0], destination:null, status:'idle', rating:100, maintenance:true };
        gameData.planes.push(newPlane);
        updateUI(); saveGame(); notify(`Bought new ${pt.name}!`);
    } else notify(`Not enough money! Plane costs $${pt.cost}`);
}

// ===== Flight Functions =====
function assignRoute(id){ 
    const plane=gameData.planes.find(p=>p.id===id); 
    const dest=prompt('Enter airport code:'); 
    if(gameData.unlockedAirports.includes(dest)&&dest!==plane.location){ 
        plane.destination=dest; plane.status='flying'; flyPlane(plane); notify(`${plane.type} flying to ${dest}`);
    } else notify('Invalid destination'); 
}
function autoFly(id){ 
    const plane=gameData.planes.find(p=>p.id===id); 
    const possible=gameData.unlockedAirports.filter(a=>a!==plane.location); 
    if(possible.length>0){ 
        plane.destination=possible[Math.floor(Math.random()*possible.length)]; plane.status='flying'; flyPlane(plane); 
        notify(`${plane.type} auto flying to ${plane.destination}`); 
    }
}
function flyPlane(plane){
    const start = airportsData.find(a=>a.code===plane.location);
    const end = airportsData.find(a=>a.code===plane.destination);
    if(!start||!end) return;

    const planeIcon = L.divIcon({html:'✈️', className:'plane-emoji', iconSize:[30,30]});
    const marker = L.marker([start.lat,start.lon],{icon:planeIcon}).addTo(map);

    const steps=50, latStep=(end.lat-start.lat)/steps, lonStep=(end.lon-start.lon)/steps;
    let step=0;
    const interval = setInterval(()=>{
        step++;
        marker.setLatLng([start.lat+latStep*step, start.lon+lonStep*step]);
        if(step>=steps){
            clearInterval(interval);
            map.removeLayer(marker);
            plane.location = plane.destination;
            plane.destination = null;
            plane.status = 'idle';
            plane.maintenance = false;

            // Calculate earnings
            const earnings = calculateEarnings(plane,start,end);
            gameData.money += earnings;

            // Rating decreases
            plane.rating -= Math.floor(Math.random() * 10);

            // Random events
            const r = Math.random();
            if(r<0.1) { plane.rating -= 5; notify('Passengers unhappy due to turbulence!'); }
            else if(r<0.2) { gameData.money += 500; notify('Good weather! Extra passengers paid $500'); }

            notify(`Flight complete! Earned $${Math.floor(earnings)}`);
            updateUI(); saveGame();
        }
    }, 1000/planeTypes.find(pt=>pt.name===plane.type).speed);
}
function calculateEarnings(plane,start,end){ const d=getDistance(start.lat,start.lon,end.lat,end.lon); const pt=planeTypes.find(pt=>pt.name===plane.type); return d*10*pt.earningsMultiplier*(plane.rating/100); }
function getDistance(lat1,lon1,lat2,lon2){ const toRad=x=>x*Math.PI/180; const R=6371,dLat=toRad(lat2-lat1),dLon=toRad(lon2-lon1); const a=Math.sin(dLat/2)**2+Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2; return 2*R*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)); }

// ===== Unlock Airport =====
function unlockAirport(){
    const startingAirports=['JFK','LHR','CDG'];
    const available=airportsData.map(a=>a.code).filter(c=>!gameData.unlockedAirports.includes(c));
    if(available.length===0){ notify('All airports unlocked'); return; }
    const code=prompt('Enter airport code to unlock:');
    if(!available.includes(code)) { notify('Invalid code or already unlocked'); return; }
    const cost = 50000 + (gameData.unlockedAirports.length-3)*10000;
    if(gameData.money>=cost){ gameData.money-=cost; gameData.unlockedAirports.push(code); updateAirports(); updateUI(); saveGame(); notify(`Unlocked ${code} for $${cost}`); }
    else notify(`Not enough money. Cost: $${cost}`);
}

// ===== Passive Income =====
setInterval(()=>{ gameData.money += 1000; updateUI(); saveGame(); },5000);
</script>
</body>
</html>
