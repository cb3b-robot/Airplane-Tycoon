<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Airplane Tycoon</title>
<style>
  body, html {
    margin: 0; padding: 0; height: 100%; font-family: Arial, sans-serif;
  }
  #map { height: 100%; width: 100%; position: fixed; top: 0; left: 0; z-index: 1; }
  #airport-list {
    position: fixed; top: 10px; left: 10px; z-index: 1000;
    background: rgba(255,255,255,0.9); padding: 10px;
    max-height: 90vh; overflow-y: auto;
    width: 260px;
    border-radius: 5px;
    font-size: 14px;
  }
  #airport-list h2 { margin-top: 0; }
  #airport-list ul { list-style: none; padding-left: 0; margin: 0; }
  #airport-list li {
    cursor: pointer; padding: 6px; border-bottom: 1px solid #ddd;
  }
  #airport-list li:hover { background-color: #e0f7fa; }
  #airport-list li.unlocked { font-weight: bold; }
  #airport-list li.selected { background-color: #a7ffeb; }

  #topbar {
    position: fixed; top: 10px; right: 10px; z-index: 1000;
    background: rgba(255,255,255,0.9); padding: 10px 15px;
    border-radius: 5px;
    display: flex;
    gap: 15px;
    font-size: 14px;
  }
  #upgrades {
    position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%);
    z-index: 1000;
    background: rgba(255,255,255,0.95);
    padding: 10px;
    border-radius: 5px;
    font-size: 14px;
    max-width: 95vw;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
  }
  #upgrades button {
    cursor: pointer;
    padding: 8px 14px;
    font-size: 14px;
    border: 1px solid #00796b;
    background-color: #004d40;
    color: white;
    border-radius: 5px;
    transition: background-color 0.3s ease;
  }
  #upgrades button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  #upgrades button:hover:not(:disabled) {
    background-color: #00796b;
  }

  /* Plane icon styling */
  .plane-icon {
    font-size: 28px;
    pointer-events: none;
    user-select: none;
  }

  /* Movement controls */
  #movement-controls {
    position: fixed;
    bottom: 80px; right: 20px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  #movement-controls button {
    background-color: #004d40;
    border: none;
    color: white;
    font-size: 18px;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
  }
  #movement-controls button:active {
    background-color: #00796b;
  }

  /* Hint boxes */
  .hint-box {
    background: rgba(255 255 255 / 0.9);
    border: 1px solid #666;
    padding: 6px 10px;
    font-size: 13px;
    border-radius: 6px;
    margin-top: 10px;
  }
  .hint-box button {
    margin-top: 6px;
    padding: 4px 8px;
    font-size: 12px;
    cursor: pointer;
  }

  /* Position hints */
  #hint-airports { margin-top: 10px; }
  #hint-map {
    position: fixed;
    bottom: 150px;
    right: 20px;
    z-index: 1001;
    max-width: 250px;
  }
  #hint-upgrades {
    margin-top: 10px;
  }
</style>
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
/>
</head>
<body>

<!-- Airport list -->
<div id="airport-list">
  <h2>Airports</h2>
  <ul id="airport-items"></ul>
  <div class="hint-box" id="hint-airports">
    Select an airport to fly your planes there.<br />
    Locked airports can be unlocked using money.<br />
    <button onclick="dismissHint('hint-airports')">Got it</button>
  </div>
</div>

<!-- Map container -->
<div id="map"></div>

<!-- Map hint -->
<div class="hint-box" id="hint-map">
  Use arrow buttons to move the map.<br />
  Zoom in and out with your mouse or pinch.<br />
  <button onclick="dismissHint('hint-map')">Got it</button>
</div>

<!-- Top info bar -->
<div id="topbar">
  <div>üí∞ Money: $<span id="money">0</span></div>
  <div>‚úàÔ∏è Planes: <span id="planes">0</span></div>
  <div>üöÄ Plane Tier: <span id="plane-tier">Basic</span></div>
  <div>‚≠ê VIP Customers: <span id="vip-status">No</span></div>
</div>

<!-- Upgrade buttons -->
<div id="upgrades">
  <button id="buy-plane-btn">Buy Plane ($10,000)</button>
  <button id="upgrade-plane-btn">Upgrade Plane ($50,000)</button>
  <button id="unlock-airport-btn">Unlock Airport ($20,000)</button>
  <button id="buy-vip-btn">Unlock VIP Customers ($100,000)</button>
  <button id="reset-progress-btn" style="background:#dc3545; color:white;">Reset Progress</button>
  <div class="hint-box" id="hint-upgrades">
    Buy planes and upgrades here to grow your airline.<br />
    <button onclick="dismissHint('hint-upgrades')">Got it</button>
  </div>
</div>

<!-- Movement controls -->
<div id="movement-controls">
  <button id="move-up">‚Üë</button>
  <button id="move-left">‚Üê</button>
  <button id="move-down">‚Üì</button>
  <button id="move-right">‚Üí</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script>
  // Hint dismiss function
  function dismissHint(id) {
    document.getElementById(id).style.display = 'none';
  }

  // Airport data with unlock costs
  const airports = [
    { code: "JFK", name: "John F. Kennedy Intl", coords: [40.6413, -73.7781], unlocked: false, cost: 20000 },
    { code: "LAX", name: "Los Angeles Intl", coords: [33.9416, -118.4085], unlocked: false, cost: 20000 },
    { code: "ORD", name: "O'Hare Intl", coords: [41.9742, -87.9073], unlocked: false, cost: 20000 },
    { code: "ATL", name: "Hartsfield-Jackson Atlanta Intl", coords: [33.6407, -84.4277], unlocked: false, cost: 20000 },
    { code: "LHR", name: "London Heathrow", coords: [51.4700, -0.4543], unlocked: false, cost: 25000 },
    { code: "NRT", name: "Narita Intl", coords: [35.7719, 140.3929], unlocked: false, cost: 25000 },
    { code: "DXB", name: "Dubai Intl", coords: [25.2532, 55.3657], unlocked: false, cost: 30000 },
    { code: "SYD", name: "Sydney Kingsford Smith", coords: [-33.9399, 151.1753], unlocked: false, cost: 30000 }
  ];

  // Game state
  let money = 50000;
  let planes = 1;
  let currentAirport = null;
  const planeTiers = [
    { name: "Basic", earningsMultiplier: 1, upgradeCost: 50000 },
    { name: "Advanced", earningsMultiplier: 2, upgradeCost: 150000 },
    { name: "Luxury", earningsMultiplier: 5, upgradeCost: 500000 }
  ];
  let currentPlaneTierIndex = 0;
  let vipUnlocked = false;
  const vipMultiplier = 2;

  // DOM elements
  const airportListUl = document.getElementById('airport-items');
  const moneySpan = document.getElementById('money');
  const planesSpan = document.getElementById('planes');
  const planeTierSpan = document.getElementById('plane-tier');
  const vipStatusSpan = document.getElementById('vip-status');

  // Movement buttons
  const moveUpBtn = document.getElementById('move-up');
  const moveDownBtn = document.getElementById('move-down');
  const moveLeftBtn = document.getElementById('move-left');
  const moveRightBtn = document.getElementById('move-right');

  // Initialize Leaflet map
  const map = L.map('map').setView([40.6413, -73.7781], 3);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Airport markers
  const airportMarkers = new Map();

  airports.forEach(airport => {
    const marker = L.marker(airport.coords).addTo(map);
    marker.bindPopup(`<b>${airport.code}</b><br>${airport.name}`);
    airportMarkers.set(airport.code, marker);
  });

  // Plane icon marker
  let planeIcon = null;
  let flightProgress = 0;
  let flightFrom = null;
  let flightTo = null;
  const flightSpeed = 0.002; // Adjust speed here

  // Populate airport list and setup click handlers
  function updateAirportList() {
    airportListUl.innerHTML = '';
    airports.forEach((airport) => {
      const li = document.createElement('li');
      li.textContent = `${airport.code} - ${airport.name}`;
      if (airport.unlocked) li.classList.add('unlocked');
      if (airport === currentAirport) li.classList.add('selected');
      li.onclick = () => {
        if (airport.unlocked) {
          if (airport === currentAirport) {
            alert('You are already at this airport!');
          } else {
            flyToAirport(airport);
          }
        } else {
          alert(`Airport locked! Unlock for $${airport.cost.toLocaleString()}.`);
        }
      };
      airportListUl.appendChild(li);
    });
  }

  // Start the flight animation between two airports
  function startFlight(fromAirport, toAirport) {
    flightFrom = fromAirport;
    flightTo = toAirport;
    flightProgress = 0;

    if (!planeIcon) {
      planeIcon = L.marker(flightFrom.coords, {
        icon: L.divIcon({
          className: 'plane-icon',
          html: '‚úàÔ∏è',
          iconSize: [28, 28],
          iconAnchor: [14, 14]
        }),
        interactive: false
      }).addTo(map);
    } else {
      planeIcon.setLatLng(flightFrom.coords).addTo(map);
    }
  }

  // Animate flight in game loop
  function animateFlight() {
    if (!planeIcon || !flightFrom || !flightTo) return;
    if (flightFrom === flightTo) return; // no flight in progress

    flightProgress += flightSpeed;
    if (flightProgress >= 1) {
      flightProgress = 0;

      // Earn money for completed flight
      let earnings = 2000 * planes * planeTiers[currentPlaneTierIndex].earningsMultiplier;
      if (vipUnlocked) earnings *= vipMultiplier;
      money += earnings;
      updateInfo();
      saveProgress();

      // Swap airports to continue flying back
      const temp = flightFrom;
      flightFrom = flightTo;
      flightTo = temp;
      updateAirportList();
    }
    // Calculate plane position on path
    const lat = flightFrom.coords[0] + (flightTo.coords[0] - flightFrom.coords[0]) * flightProgress;
    const lng = flightFrom.coords[1] + (flightTo.coords[1] - flightFrom.coords[1]) * flightProgress;
    planeIcon.setLatLng([lat, lng]);
  }

  // Fly to a new airport (start a flight)
  function flyToAirport(airport) {
    if (airport === currentAirport) {
      alert('You are already at this airport!');
      return;
    }
    startFlight(currentAirport, airport);
    currentAirport = airport;
    updateAirportList();
  }

  // Update game info UI
  function updateInfo() {
    moneySpan.textContent = money.toLocaleString();
    planesSpan.textContent = planes;
    planeTierSpan.textContent = planeTiers[currentPlaneTierIndex].name;
    vipStatusSpan.textContent = vipUnlocked ? 'Yes' : 'No';
  }

  // Save game state
  function saveProgress() {
    const saveData = {
      money,
      planes,
      currentAirportCode: currentAirport ? currentAirport.code : null,
      airportsUnlockedCodes: airports.filter(a => a.unlocked).map(a => a.code),
      currentPlaneTierIndex,
      vipUnlocked
    };
    localStorage.setItem('airplaneTycoonSave', JSON.stringify(saveData));
  }

  // Load game state
  function loadProgress() {
    const saveStr = localStorage.getItem('airplaneTycoonSave');
    if (!saveStr) return false;
    try {
      const saveData = JSON.parse(saveStr);
      money = saveData.money ?? money;
      planes = saveData.planes ?? planes;
      airports.forEach(a => {
        a.unlocked = saveData.airportsUnlockedCodes.includes(a.code);
      });
      currentPlaneTierIndex = saveData.currentPlaneTierIndex ?? 0;
      vipUnlocked = saveData.vipUnlocked ?? false;
      currentAirport = airports.find(a => a.code === saveData.currentAirportCode);
      return true;
    } catch {
      return false;
    }
  }

  // Upgrade button handlers
  document.getElementById('buy-plane-btn').onclick = () => {
    if (money >= 10000) {
      money -= 10000;
      planes++;
      updateInfo();
      saveProgress();
      updateButtons();
    } else {
      alert('Not enough money to buy a plane!');
    }
  };

  document.getElementById('upgrade-plane-btn').onclick = () => {
    if (currentPlaneTierIndex < planeTiers.length - 1) {
      const nextTier = planeTiers[currentPlaneTierIndex + 1];
      if (money >= nextTier.upgradeCost) {
        money -= nextTier.upgradeCost;
        currentPlaneTierIndex++;
        updateInfo();
        saveProgress();
        updateButtons();
      } else {
        alert('Not enough money to upgrade plane!');
      }
    } else {
      alert('You already have the best plane tier!');
    }
  };

  document.getElementById('unlock-airport-btn').onclick = () => {
    const lockedAirport = airports.find(a => !a.unlocked);
    if (!lockedAirport) {
      alert('All airports unlocked!');
      return;
    }
    if (money >= lockedAirport.cost) {
      money -= lockedAirport.cost;
      lockedAirport.unlocked = true;
      updateAirportList();
      updateInfo();
      saveProgress();
      updateButtons();
    } else {
      alert(`Not enough money to unlock ${lockedAirport.code}!`);
    }
  };

  document.getElementById('buy-vip-btn').onclick = () => {
    if (vipUnlocked) {
      alert('VIP customers already unlocked!');
      return;
    }
    if (money >= 100000) {
      money -= 100000;
      vipUnlocked = true;
      updateInfo();
      saveProgress();
      updateButtons();
    } else {
      alert('Not enough money to unlock VIP customers!');
    }
  };

  document.getElementById('reset-progress-btn').onclick = () => {
    if (confirm('Are you sure you want to reset progress?')) {
      localStorage.removeItem('airplaneTycoonSave');
      location.reload();
    }
  };

  // Enable/disable buttons based on money and state
  function updateButtons() {
    document.getElementById('buy-plane-btn').disabled = money < 10000;
    document.getElementById('unlock-airport-btn').disabled = !airports.some(a => !a.unlocked && money >= a.cost);
    document.getElementById('upgrade-plane-btn').disabled = (currentPlaneTierIndex >= planeTiers.length - 1) || money < planeTiers[currentPlaneTierIndex + 1]?.upgradeCost;
    document.getElementById('buy-vip-btn').disabled = vipUnlocked || money < 100000;
  }

  // Movement controls handlers
  const moveAmount = 5; // degrees to move map on each press
  moveUpBtn.onclick = () => {
    const c = map.getCenter();
    map.panTo([c.lat + moveAmount, c.lng]);
  };
  moveDownBtn.onclick = () => {
    const c = map.getCenter();
    map.panTo([c.lat - moveAmount, c.lng]);
  };
  moveLeftBtn.onclick = () => {
    const c = map.getCenter();
    map.panTo([c.lat, c.lng - moveAmount]);
  };
  moveRightBtn.onclick = () => {
    const c = map.getCenter();
    map.panTo([c.lat, c.lng